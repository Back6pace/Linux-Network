## Part 1. Инструмент **ipcalc**

- Поднять виртуальную машину (далее -- ws1)
Мануал `ipcalc` можно прочесть [здесь](https://www.opennet.ru/man.shtml?topic=ipcalc&category=1&russian=0).<br>

>**Описание** <br>
***ipcalc*** предоставляет простой метод для вычисления IP-информации хоста. Различные опции определяют, какую информацию ipcalc должен вывести на стандартный выход. Могут быть заданы несколько опций. Обрабатываемый IP-адрес всегда должен быть указан. Для большинства операций также требуется сетевая маска или префикс CIDR. 
>- **Некоторые из применений**:
>   - Проверить IP-адрес
>   - Показать рассчитанный широковещательный адрес
>   - Отображение имени хоста, определенного через DNS
>   - Показать сетевой адрес или префикс
- Обновим пакеты по необходимости:
  - `sudo apt-get update && sudo apt-get upgrade`
- Установим утилиту
  - `sudo apt-get -y install ipcalc`

### Part 1.1 Сети и маски

1. Адрес сети 192.167.38.54/13 - 192.160.0.0

``ipcalc 192.167.38.54/13``

![ipcalc 192.167.38.54/13](img/ipcalc.png)

2. Перевод маски 255.255.255.0 в префиксную и двоичную запись, /15 в обычную и двоичную, 11111111.11111111.11111111.11110000 в обычную и префиксную

- /24 - префиксканая 
- 11111111.11111111.11111111.00000000 - двоичная запись

``ipcacl 255.255.255.0``

![ipcacl 255.255.255.0](img/ipcalc2.png)

- 255.254.0.0
- 11111111.11111111.00000000.00000000

``ipcalc 0.0.0.0/15``
![!\[ipcalc /15\](img/ipcalc3.png)](img/ipcalc000015.png)

- 255.255.255.240
- /28

``ipcalc 0.0.0.0/28``

![!\[ipcalc 11111111.11111111.11111111.11110000\](img/ipcalc5.png)](img/ipcalc000028.png)

3. Минимальный и максимальный хост в сети 12.167.38.4 при масках: /8, 11111111.11111111.00000000.00000000, 255.255.254.0 и /4

- /8
    - 12.0.0.1
    - 12.255.255.254
![ipcalc](img/ipcalc6.png)

- /4
    - 0.0.0.1
    - 15.255.255.254
![ipcalc](img/ipcalc7.png)

- /16 = 11111111.11111111.00000000.00000000
    - 12.167.0.1
    - 12.167.255.254
![ipcalc](img/ipcalc8.png)

- /23 = 255.255.254.0
    - 12.167.38.1
    - 12.167.39.255
![ipcalc](img/ipcalc9.png)

### Part 1.2 localhost

>Определить и записать в отчёт, можно ли обратиться к приложению, работающему на localhost, со следующими IP: 194.34.23.100, 127.0.0.2, 127.1.0.1, 128.0.0.1

Диапазон IP адресов, которые предназначены для создания локальной сети -> 127.0.0.1 - 127.255.255.255

- 194.34.23.100 -> не работает
- 127.0.0.2 -> работает
- 127.1.0.1 -> работает
- 128.0.0.1 -> не работает

### Part 1.3 Диапазоны и сегменты сетей

>1. Какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных: 10.0.0.45, 134.43.0.2, 192.168.4.2, 172.20.250.4, 172.0.2.1, 192.172.0.1, 172.68.0.2, 172.16.255.255, 10.10.10.10, 192.169.168.1

Частные Ip-адреса<br>
От 10.0.0.0 до 10.255.255.255 с маской 255.0.0.0 или /8<br>
От 172.16.0.0 до 172.31.255.255 с маской 255.240.0.0 или /12<br>
От 192.168.0.0 до 192.168.255.255 с маской 255.255.0.0 или /16<br>
От 100.64.0.0 до 100.127.255.255 с маской подсети 255.192.0.0 или /10

``10.0.0.45`` -  Частный<br>
``134.43.0.2`` - Публичный<br>
``192.168.4.2`` - Частный<br>
``172.20.250.4`` - Частный<br>
``172.0.2.1`` - Публичный<br>
``192.172.0.1`` - Публичный<br>
``172.68.0.2`` - Публичный<br>
``172.16.255.255`` - Частный<br>
``10.10.10.10`` - Частный<br>
``192.169.168.1`` - Публичный


>2. Какие из перечисленных IP адресов шлюза возможны у сети 10.10.0.0/18: 10.0.0.1, 10.10.0.2, 10.10.10.10, 10.10.100.1, 10.10.1.255

![ipalc](img/1.3.png)
Диапозон от 10.10.0.1 до 10.10.63.254

10.0.0.1 - нет<br>
10.10.0.2 - да<br>
10.10.10.10 - да<br>
10.10.100.1 - нет<br>
10.10.1.255 - да

## Part 2. Статическая маршрутизация между двумя машинами

Поднять две виртуальные машины (далее -- ws1 и ws2)
![2ws](img/2ws.png)

``ip a``

- ws1

![ws1](img/ipaws1.png)

- ws2

![ws2](img/ipaws2.png)

Описать сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и задать следующие адреса и маски: ws1 - 192.168.100.10, маска /16, ws2 - 172.24.116.8, маска /12

- ws1

![ws1](img/netws1.png)

- ws2

![ws2](img/netws2.png)

### Part 2.1

Добавить статический маршрут от одной машины до другой и обратно при помощи команды вида ``ip r add``<br>
Пропинговать соединение между машинами

``sudo ip r add 172.24.116.8 dev enp0s3``

``ping 172.24.116.8``

![ws1](img/iprws1.png)

``sudo ip r add 192.168.100.10 dev enp0s3``

``ping 192.168.100.10``

![ws1](img/ipws2.png)

### Part 2.2

- Перезапустить машины
- `sudo reboot` x2

- Добавить статический маршрут от одной машины до другой с помощью файла *etc/netplan/00-installer-config.yaml*

- ws1
![ws1](img/netws1.1.png)

- ws2
![ws1](img/netws2.2.png)

- Пропинговать соединение между машинами

- ws1
``ping -c 4 172.24.116.8``
![ws1](img/pingws1.png)

- ws2
``ping -c 4 192.168.100.10``
![ws1](img/pingws2.png)

## Part 3. Утилита iperf3

>iPerf3 — консольная утилита. С ее помощью можно измерить максимальную пропускную способность сети между сервером ВКС и клиентом или провести нагрузочное тестирование канала связи для определения уровня потерь.

Здесь можно прочитать мануал на эту утилиту -> [iperf3](https://manpages.ubuntu.com/manpages/xenial/man1/iperf3.1.html)

### Part 3.1. Скорость соединения

>По аналогии с единицей измерения скорости физических тел — метров в секунду (м/с) — скорость интернет-соединения обычно указывают в битах в секунду (бит/с) и его производных: Кбит/с, Мбит/с, Гбит/с.

`Переведи и запиши в отчёт: 8 Mbps в MB/s, 100 MB/s в Kbps, 1 Gbps в Mbps.`

- 8 Mbps = 1 MB/s
- 100 MB/s = 800000 Kbps
- 1 Gbps = 1000 Mbps

### Part 3.2. Утилита iperf3

> - ``iperf3`` — это инструмент для измерения пропускной способности сети. Он может тестировать TCP или пропускная способность UDP. Для выполнения теста iperf3 пользователь должен установить как сервер, так и клиент
> - **Использование**<br>
>   - iperf3 -s [ options ]
>   - iperf3 -c [ options ]<br>
*-s* -> запуск серверного мода<br>
*-c* -> запустить в режиме клиента и подключиться к серверу

> Измерь скорость соединения между ws1 и ws2.

У нас включно только локальное соединение, поэтому для обоих машин делаем настройку сети
- NAT (network address translation) - механизм преобразования ссетевых адресов<br>
Network Address Translation - это механизм в сетях TCP/IP, позволяющий изменять IP адрес в заголовке пакета, проходящего через устройство маршрутизации трафика.
![Alt text](img/nat.png)
![Alt text](img/internalnetworl.png)

Затем корректируем наш yaml 

![Alt text](<img/ws1 netplan upd.png>)
![Alt text](<img/ws2 netplan upd.png>)

И сейчас устанавливаем саму утилиту iperf3<br>
`sudo apt install iperf3`

- ws1<br>
`iperf3 -s`
![Alt text](img/iperf3ws1.png)

- ws2<br>
`iperf3 -c 192.168.100.10`
![Alt text](<img/iperf3 ws2.png>)

## Part 4. Сетевой экран
### Part 4.1 Утилита iptables

> Мануал на данную утилиту -> [здесь](https://www.opennet.ru/man.shtml?topic=iptables&category=8&russian=0)<br>
Более подробный вы можете найти -> [тут](https://losst.pro/nastrojka-iptables-dlya-chajnikov)
>- **iptables** - инструмент администрирования фильтра пакетов IPv4 и NAT 
> - **Использование `iptables`**<br>
> -A - добавить правило в цепочку;<br>
> -С - проверить все правила;<br>
> -D - удалить правило;<br>
> -I - вставить правило с нужным номером;<br>
> -L - вывести все правила в текущей цепочке;<br>
> -S - вывести все правила;<br>
> -F - очистить все правила;<br>
> -N - создать цепочку;<br>
> -X - удалить цепочку;<br>
> -P - установить действие по умолчанию.

Создай файл /etc/firewall.sh, имитирующий фаерволл, на ws1 и ws2:

```shell
#!/bin/sh

# Удаление всех правил в таблице «filter» (по-умолчанию).
iptables -F
iptables -X
```

`sudo touch /etc/firewall.sh`<br>
`sudo nano /etc/firewall.sh`
1. На ws1 применить стратегию когда в начале пишется запрещающее правило, а в конце пишется разрешающее правило (это касается пунктов 4 и 5)
2. На ws2 применить стратегию когда в начале пишется разрешающее правило, а в конце пишется запрещающее правило (это касается пунктов 4 и 5)
3. Открыть для машин доступ к 22 и 80 портам (ssh и http)
4. Запретить echo reply (машина не должна "пинговаться”, т.е. должна быть блокировка на OUTPUT)
5. Разрешить echo reply (машина должна "пинговаться")

- ws1
![!\[Alt text\](<img/iptable ws1.png>)](<img/iptable ws1.png>)

- ws2
![Alt text](<img/iptables ws2.png>)

Разница в том что в первом файле первое правило запрета а во втором разрешения на отправку пакетов. Последующие правила будут игнорироваться

Запусти файлы на обеих машинах командами ``chmod +x /etc/firewall.sh и /etc/firewall.sh.``

![Alt text](<img/chmod ws1.png>)
![Alt text](<img/chmod ws2.png>)

### Part 4.2. Утилита nmap

- Командой **ping** найти машину, которая не "пингуется", после чего утилитой **nmap** показать, что хост машины запущен
*Проверка: в выводе nmap должно быть сказано: `Host is up`*
- В отчёт поместить скрины с вызовом и выводом использованных команд **ping** и **nmap**.

- `sudo apt install nmap`


- `ping 172.24.116.8`
![Alt text](<img/ping ws1 - ws2.png>)
- `sudo nmap 172.24.116.8`
![Alt text](<img/nmap ws1.png>)
- `ping 192.168.100.10`
![Alt text](<img/ping ws2-ws1.png>)
- `sudo nmap 192.168.100.10`
![Alt text](<img/nmap ws2.png>)

## Part 5. Статическая маршрутизация сети

Подними пять виртуальных машин (3 рабочие станции (ws11, ws21, ws22) и 2 роутера (r1, r2)).

![Alt text](img/part5_network.png)